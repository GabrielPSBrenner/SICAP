CREATE TABLE dbo.PARAMETRO (
  PACodigo INT NOT NULL IDENTITY,
  PATempoExpiraSaida FLOAT NOT NULL,
  PAServidorDominio VARCHAR(100) NOT NULL,
  PAServidorCorreio VARCHAR(100) NOT NULL,
  PRIMARY KEY(PACodigo)
);


CREATE TABLE dbo.PONTOCONTROLE (
  PoCodigo INT NOT NULL IDENTITY,
  PoTipo CHAR(1) NOT NULL,
  PoNome VARCHAR(50) NOT NULL,
  PoDescricao VARCHAR(255) NULL,
  PoBiometria BIT NOT NULL,
  PoCartaoRFID BIT NOT NULL,
  PoSenha BIT NOT NULL,
  PoSmartCard BIT NOT NULL,
  PoObservacao TEXT NOT NULL,
  PoControlaSaida BIT NOT NULL,
  PoDisparaAlarme BIT NOT NULL,
  PoTentativaIndevidaDisparaAlarme TINYINT NULL,
  PoPermiteLiberacaoForcada BIT NOT NULL,
  PRIMARY KEY(PoCodigo, PoTipo)
);


CREATE TABLE dbo.FORNECEDOR (
  FOCNPJ VARCHAR(14) NOT NULL IDENTITY,
  FORazaoSocial VARCHAR(100) NOT NULL,
  FONomeFantasia VARCHAR(100) NULL,
  PRIMARY KEY(FOCNPJ)
);


CREATE TABLE dbo.LOCALIDADE (
  LoCodigo INT NOT NULL IDENTITY,
  LoNome VARCHAR(50) NOT NULL,
  PRIMARY KEY(LoCodigo)
);


CREATE TABLE dbo.TIPOEQUIPAMENTO (
  TECodigo INT NOT NULL IDENTITY,
  TEDescricao VARCHAR(50) NULL,
  PRIMARY KEY(TECodigo)
);


CREATE TABLE dbo.VISITANTE (
  ViCodigo INT NOT NULL IDENTITY,
  ViNome VARCHAR(50) NOT NULL,
  PRIMARY KEY(ViCodigo)
);


CREATE TABLE dbo.ROTA (
  ROCodigo INT NOT NULL IDENTITY,
  RONome VARCHAR(50) NOT NULL,
  RODescricao TEXT NULL,
  ROAtiva BIT NULL,
  PRIMARY KEY(ROCodigo)
);


CREATE TABLE dbo.TERCEIRO (
  TeCodigo INT NOT NULL IDENTITY,
  TeNome VARCHAR(50) NOT NULL,
  PRIMARY KEY(TeCodigo)
);


CREATE TABLE dbo.FABRICANTE (
  FaCodigo INT NOT NULL IDENTITY,
  FaNome VARCHAR(50) NULL,
  PRIMARY KEY(FaCodigo)
);


CREATE TABLE dbo.DIGITAL (
  DiCodigo INT NOT NULL IDENTITY,
  DiImgDigital BLOB NOT NULL,
  DiMao CHAR(1) NOT NULL,
  DiDedo CHAR(1) NOT NULL,
  DiDataVencimento DATETIME NOT NULL,
  PRIMARY KEY(DiCodigo)
);


CREATE TABLE dbo.LOTACAO (
  LoCodigo VARCHAR(15) NOT NULL,
  LoCodigoLocalidade INT NOT NULL,
  LoNome VARCHAR(100) NOT NULL,
  LoSigla VARCHAR(10) NOT NULL,
  LoAtivo BIT NOT NULL,
  LoDescricao TEXT NULL,
  PRIMARY KEY(LoCodigo, LoCodigoLocalidade),
    CONSTRAINT FK_LOTACAOLOCALIDADERel_14 FOREIGN KEY(LoCodigoLocalidade)
    REFERENCES LOCALIDADE(LoCodigo)
);

CREATE INDEX Lotacao_FKIndex1 ON LOTACAO(LoCodigoLocalidade);

CREATE TABLE dbo.ESTAGIARIO (
  ESCodigo INT NOT NULL IDENTITY,
  ESCodigoLocalidade INT NOT NULL,
  ESCodigoLotacao VARCHAR(15) NOT NULL,
  ESNome VARCHAR(50) NOT NULL,
  PRIMARY KEY(ESCodigo),
    CONSTRAINT FK_ESTAGIARIOLOTACAORel_29 FOREIGN KEY(ESCodigoLotacao, ESCodigoLocalidade)
    REFERENCES LOTACAO(LoCodigo, LoCodigoLocalidade)
);

CREATE INDEX ESTAGIARIO_FKIndex1 ON ESTAGIARIO(ESCodigoLotacao, ESCodigoLocalidade);

CREATE TABLE dbo.CARTAO (
  CrCodigo INT NOT NULL IDENTITY,
  CrCodigoFabricante INT NOT NULL,
  CrTipo CHAR(1) NOT NULL,
  CrNumeroCartao VARCHAR(50) NOT NULL,
  CrAuxiliar BLOB NULL,
  CrDataCadastro DATETIME NOT NULL,
  CrBloqueado BIT NULL,
  CrMotivoBloqueio VARCHAR(255) NULL,
  CrDataBloqueio DATETIME NULL,
  PRIMARY KEY(CrCodigo),
    CONSTRAINT FK_CARTAOFABRICANTERel_28 FOREIGN KEY(CrCodigoFabricante)
    REFERENCES FABRICANTE(FaCodigo)
);

CREATE INDEX CARTAO_FKIndex1 ON CARTAO(CrCodigoFabricante);

CREATE TABLE dbo.FUNCIONARIO (
  FUMATFUNC INT NOT NULL IDENTITY,
  FUCodigoLocalidade INT NOT NULL,
  FUCodigoLotacao VARCHAR(15) NOT NULL,
  FUNOMFUNC VARCHAR(100) NOT NULL,
  PRIMARY KEY(FUMATFUNC),
    CONSTRAINT FK_FUNCIONARIOLOTACAORel_15 FOREIGN KEY(FUCodigoLotacao, FUCodigoLocalidade)
    REFERENCES LOTACAO(LoCodigo, LoCodigoLocalidade)
);

CREATE INDEX FUNCIONARIO_FKIndex2 ON FUNCIONARIO(FUCodigoLotacao, FUCodigoLocalidade);

CREATE TABLE dbo.VISITA (
  VtCodigo INT NOT NULL IDENTITY,
  VtCodigoVisitante INT NOT NULL,
  VtDataInicio DATETIME NOT NULL,
  VtDataTermino DATETIME NULL,
  VtMotivo VARCHAR(100) NOT NULL,
  PRIMARY KEY(VtCodigo),
    CONSTRAINT FK_VISITAVISITANTERel_30 FOREIGN KEY(VtCodigoVisitante)
    REFERENCES VISITANTE(ViCodigo)
);

CREATE INDEX VISITA_FKIndex1 ON VISITA(VtCodigoVisitante);

CREATE TABLE dbo.PONTOROTA (
  PRCodigoPontoControle INT NOT NULL,
  PRCodigoRota INT NOT NULL,
  PRTipoPontoControle CHAR(1) NOT NULL,
  PROrdem INT NOT NULL,
  PRTempoMaxPerm INT NOT NULL,
  PRIMARY KEY(PRCodigoPontoControle, PRCodigoRota, PRTipoPontoControle),
      CONSTRAINT FK_PONTOROTAPONTOCONTROLERel_05 FOREIGN KEY(PRCodigoPontoControle, PRTipoPontoControle)
    REFERENCES PONTOCONTROLE(POCodigo, POTipo),
  CONSTRAINT FK_PONTOROTAROTARel_06 FOREIGN KEY(PRCodigoRota)
    REFERENCES ROTA(ROCodigo)
);

CREATE INDEX PONTOCONTROLE_has_ROTA_FKIndex1 ON PONTOROTA(PRCodigoPontoControle, PRTipoPontoControle);
CREATE INDEX PONTOCONTROLE_has_ROTA_FKIndex2 ON PONTOROTA(PRCodigoRota);

CREATE TABLE dbo.LOTACAOROTA (
  LRCodigo INT NOT NULL IDENTITY,
  LRCodigoLocalidade INT NOT NULL,
  LRCodigoLotacao VARCHAR(15) NOT NULL,
  LRCodigoRota INT NOT NULL,
  LRDataInicioPermissao DATETIME NOT NULL,
  LRDataExpiracao DATETIME NOT NULL,
  PRIMARY KEY(LRCodigo),
      CONSTRAINT FK_LOTACAOROTALOTACAORel_26 FOREIGN KEY(LRCodigoLotacao, LRCodigoLocalidade)
    REFERENCES LOTACAO(LoCodigo, LoCodigoLocalidade),
  CONSTRAINT FK_LOTACAOROTAROTARel_27 FOREIGN KEY(LRCodigoRota)
    REFERENCES ROTA(ROCodigo)
);

CREATE INDEX Lotacao_has_ROTA_FKIndex1 ON LOTACAOROTA(LRCodigoLotacao, LRCodigoLocalidade);
CREATE INDEX Lotacao_has_ROTA_FKIndex2 ON LOTACAOROTA(LRCodigoRota);

CREATE TABLE dbo.EQUIPAMENTO (
  EqCodigo INT NOT NULL,
  FaCodigoFabricante INT NOT NULL,
  EqTipoEquipamento INT NOT NULL,
  EqNome VARCHAR(50) NOT NULL,
  EqTipoLibera CHAR(1) NOT NULL,
  EqTempoSinal INT NOT NULL,
  PRIMARY KEY(EqCodigo),
      CONSTRAINT FK_EQUIPAMENTOTIPOEQUIPAMENTORel_04 FOREIGN KEY(EqTipoEquipamento)
    REFERENCES TIPOEQUIPAMENTO(TECodigo),
  CONSTRAINT FK_EQUIPAMENTOFABRICANTERel_33 FOREIGN KEY(FaCodigoFabricante)
    REFERENCES FABRICANTE(FaCodigo)
);

CREATE INDEX Equipamento_FKIndex1 ON EQUIPAMENTO(EqTipoEquipamento);
CREATE INDEX EQUIPAMENTO_FKIndex2 ON EQUIPAMENTO(FaCodigoFabricante);

CREATE TABLE dbo.CONTRATOTERCEIRO (
  CTCodigo INT NOT NULL IDENTITY,
  CTCodigoLocal INT NOT NULL,
  CTCodigoLotacao VARCHAR(15) NOT NULL,
  CTCodigoTerceiro INT NOT NULL,
  CTCNPJFornecedor VARCHAR(14) NOT NULL,
  CTDataInicioContrato DATETIME NOT NULL,
  CTDataExpiracaoContrato DATETIME NOT NULL,
  CTObservacao TEXT NULL,
  PRIMARY KEY(CTCodigo),
        CONSTRAINT FK_CONTRATOTERCEIROFORNECEDORRel_16 FOREIGN KEY(CTCNPJFornecedor)
    REFERENCES FORNECEDOR(FOCNPJ),
  CONSTRAINT FK_CONTRATOTERCEIROTERCEIRORel_17 FOREIGN KEY(CTCodigoTerceiro)
    REFERENCES TERCEIRO(TeCodigo),
  CONSTRAINT FK_CONTRATOTERCEIROLOTACAORel_19 FOREIGN KEY(CTCodigoLotacao, CTCodigoLocal)
    REFERENCES LOTACAO(LoCodigo, LoCodigoLocalidade)
);

CREATE INDEX ContratoTerceiro_FKIndex1 ON CONTRATOTERCEIRO(CTCNPJFornecedor);
CREATE INDEX ContratoTerceiro_FKIndex2 ON CONTRATOTERCEIRO(CTCodigoTerceiro);
CREATE INDEX ContratoTerceiro_FKIndex4 ON CONTRATOTERCEIRO(CTCodigoLotacao, CTCodigoLocal);

CREATE TABLE dbo.USUARIO (
  USCODIGO INT NOT NULL IDENTITY,
  USCODIGOESTAGIARIO INT NOT NULL,
  USCODIGOTERCEIRO INT NULL,
  USCODIGOVISITANTE INT NULL,
  USMATFUNC INT NULL,
  USTIPO CHAR(1) NOT NULL,
  USUSUARIOREDE VARCHAR(20) NULL,
  USBloqueado BIT NOT NULL,
  USMotivoBloqueio VARCHAR(255) NULL,
  USSenhaOpcional VARCHAR(255) NULL,
  USAdministrador BIT NULL,
  USGerente BIT NULL,
  USAuditor BIT NULL,
  PRIMARY KEY(USCODIGO),
          CONSTRAINT FK_USUARIOFUNCIONARIORel_20 FOREIGN KEY(USMATFUNC)
    REFERENCES FUNCIONARIO(FUMATFUNC),
  CONSTRAINT FK_USUARIOVISITANTERel_21 FOREIGN KEY(USCODIGOVISITANTE)
    REFERENCES VISITANTE(ViCodigo),
  CONSTRAINT FK_USUARIOTERCEIRORel_22 FOREIGN KEY(USCODIGOTERCEIRO)
    REFERENCES TERCEIRO(TeCodigo),
  CONSTRAINT FK_USUARIOESTAGIARIORel_30 FOREIGN KEY(USCODIGOESTAGIARIO)
    REFERENCES ESTAGIARIO(ESCODIGO)
);

CREATE INDEX USUARIO_FKIndex1 ON USUARIO(USMATFUNC);
CREATE INDEX USUARIO_FKIndex2 ON USUARIO(USCODIGOVISITANTE);
CREATE INDEX USUARIO_FKIndex3 ON USUARIO(USCODIGOTERCEIRO);
CREATE INDEX USUARIO_FKIndex4 ON USUARIO(USCODIGOESTAGIARIO);

CREATE TABLE dbo.ROTAUSUARIO (
  RUCodigo INT NOT NULL IDENTITY,
  RUCodigoUsuario INT NOT NULL,
  RUCodigoRota INT NOT NULL,
  RUDataInicioPermissao DATETIME NOT NULL,
  RUDataExpiracao DATETIME NOT NULL,
  PRIMARY KEY(RUCodigo),
      CONSTRAINT FK_ROTAUSUARIOUSUARIORel_24 FOREIGN KEY(RUCodigoUsuario)
    REFERENCES USUARIO(USCODIGO),
  CONSTRAINT FK_ROTAUSUARIOROTARel_25 FOREIGN KEY(RUCodigoRota)
    REFERENCES ROTA(ROCodigo)
);

CREATE INDEX USUARIO_has_ROTA_FKIndex1 ON ROTAUSUARIO(RUCodigoUsuario);
CREATE INDEX USUARIO_has_ROTA_FKIndex2 ON ROTAUSUARIO(RUCodigoRota);

CREATE TABLE dbo.CARTAOUSUARIO (
  CSCODIGO INT NOT NULL IDENTITY,
  CSCodigoUsuario INT NOT NULL,
  CSCodigoCartao INT NOT NULL,
  CSDataEntrega DATETIME NOT NULL,
  CSDataExpiracao DATETIME NOT NULL,
  CSObservacao VARCHAR(255) NULL,
  PRIMARY KEY(CSCODIGO),
      CONSTRAINT FK_CARTAOUSUARIOCARTAORel_25 FOREIGN KEY(CSCodigoCartao)
    REFERENCES CARTAO(CrCodigo),
  CONSTRAINT FK_CARTAOUSUARIOUSUARIORel_26 FOREIGN KEY(CSCodigoUsuario)
    REFERENCES USUARIO(USCODIGO)
);

CREATE INDEX CARTAOUSUARIO_FKIndex1 ON CARTAOUSUARIO(CSCodigoCartao);
CREATE INDEX CARTAOUSUARIO_FKIndex2 ON CARTAOUSUARIO(CSCodigoUsuario);

CREATE TABLE dbo.EQUIPAMENTOPONTO (
  EPCodigoPontoControle INT NOT NULL,
  EPEquipamento INT NOT NULL,
  EPCodigoTipoPonto CHAR(1) NOT NULL,
  EPNumeroPortaRele INT NULL,
  PRIMARY KEY(EPCodigoPontoControle, EPEquipamento, EPCodigoTipoPonto),
      CONSTRAINT FK_EQUIPAMENTOPONTOPONTOCONTROLERel_07 FOREIGN KEY(EPCodigoPontoControle, EPCodigoTipoPonto)
    REFERENCES PONTOCONTROLE(POCodigo, POTipo),
  CONSTRAINT FK_EQUIPAMENTOPONTOEQUIPAMENTORel_08 FOREIGN KEY(EPEquipamento)
    REFERENCES EQUIPAMENTO(EqCodigo)
);

CREATE INDEX PONTOCONTROLE_has_Equipamento_FKIndex1 ON EQUIPAMENTOPONTO(EPCodigoPontoControle, EPCodigoTipoPonto);
CREATE INDEX PONTOCONTROLE_has_Equipamento_FKIndex2 ON EQUIPAMENTOPONTO(EPEquipamento);

CREATE TABLE dbo.HASHDIGITAL (
  HaCodigo INT NOT NULL IDENTITY,
  HaCodigoUsuario INT NOT NULL,
  HaCodigoDigital INT NOT NULL,
  HaCodigoEquipamento INT NOT NULL,
  HaCredencialBiometricaTextual VARCHAR(255) NULL,
  HaCredencialBiometricaBinaria BLOB NULL,
  PRIMARY KEY(HaCodigo),
        CONSTRAINT FK_HASHDIGITALEQUIPAMENTORel_02 FOREIGN KEY(HaCodigoEquipamento)
    REFERENCES EQUIPAMENTO(EqCodigo),
  CONSTRAINT FK_HASHDIGITALDIGITALRel_03 FOREIGN KEY(HaCodigoDigital)
    REFERENCES DIGITAL(DiCodigo),
  CONSTRAINT FK_HASHDIGITALUSUARIORel_23 FOREIGN KEY(HaCodigoUsuario)
    REFERENCES USUARIO(USCODIGO)
);

CREATE INDEX Hash_FKIndex1 ON HASHDIGITAL(HaCodigoEquipamento);
CREATE INDEX Hash_FKIndex2 ON HASHDIGITAL(HaCodigoDigital);
CREATE INDEX HashDigital_FKIndex3 ON HASHDIGITAL(HaCodigoUsuario);

CREATE TABLE dbo.ACESSOPONTOCONTROLE (
  APCodigo INT NOT NULL IDENTITY,
  APTipoPontoControle CHAR(1) NOT NULL,
  APCodigoUsuarioLiberaForcado INT NOT NULL,
  APCodigoUsuarioAcesso INT NOT NULL,
  APCodigoUsuarioInterrompeAlarme INT NOT NULL,
  APCodigoCartao INT NULL,
  APCodigoPontoControle INT NOT NULL,
  APDataAcesso DATETIME NOT NULL,
  APNegado BIT NOT NULL,
  APControlarSaida BIT NOT NULL,
  APDisparouAlarme BIT NULL,
  APDataInterrupcaoAlarme DATETIME NULL,
  APObservacaoInterrupcao VARCHAR(255) NULL,
  APAcessoForcado BIT NULL,
  APMotivoAcessoForcado VARCHAR(255) NULL,
  PRIMARY KEY(APCodigo),
            CONSTRAINT FK_ACESSOPONTOCONTROLEPONTOCONTROLERel_28 FOREIGN KEY(APCodigoPontoControle, APTipoPontoControle)
    REFERENCES PONTOCONTROLE(POCodigo, POTipo),
  CONSTRAINT FK_ACESSOPONTOCONTROLEUSUARIORel_29 FOREIGN KEY(APCodigoUsuarioAcesso)
    REFERENCES USUARIO(USCODIGO),
  CONSTRAINT FK_ACESSOPONTOCONTROLECARTAOUSUARIORel_27 FOREIGN KEY(APCodigoCartao)
    REFERENCES CARTAOUSUARIO(CSCODIGO),
  CONSTRAINT FK_ACESSOPONTOCONTROLEUSUARIORel_31 FOREIGN KEY(APCodigoUsuarioInterrompeAlarme)
    REFERENCES USUARIO(USCODIGO),
  CONSTRAINT FK_ACESSOPONTOCONTROLEUSUARIORel_32 FOREIGN KEY(APCodigoUsuarioLiberaForcado)
    REFERENCES USUARIO(USCODIGO)
);

CREATE INDEX AcessoPontoControle_FKIndex1 ON ACESSOPONTOCONTROLE(APCodigoPontoControle, APTipoPontoControle);
CREATE INDEX AcessoPontoControle_FKIndex2 ON ACESSOPONTOCONTROLE(APCodigoUsuarioAcesso);
CREATE INDEX ACESSOPONTOCONTROLE_FKIndex3 ON ACESSOPONTOCONTROLE(APCodigoCartao);
CREATE INDEX ACESSOPONTOCONTROLE_FKIndex4 ON ACESSOPONTOCONTROLE(APCodigoUsuarioInterrompeAlarme);
CREATE INDEX ACESSOPONTOCONTROLE_FKIndex5 ON ACESSOPONTOCONTROLE(APCodigoUsuarioLiberaForcado);

